{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %} MindMuse {% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre&family=Josefin+Sans:ital@1&display=swap" rel="stylesheet">



    <script src="{% static 'js/hub.js' %}"></script>
    <script src="{% static 'js/task.js' %}"></script>
    <script src="{% static 'js/passion.js' %}"></script>
    {% if url_name == 'second_brain:home' %}
      <script src="{% static 'js/quote.js' %}"></script>
    {% endif %}
    <script src="{% static 'js/insight.js' %}"></script>
    {% if url_name != 'insights:insights' %}
      <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    {% endif %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.5.1/jscolor.min.js"></script> 

</head>
<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary" style="background-color: #452475 !important;">
      <div class="container-fluid">
        <a class="navbar-brand ms-4" href="{% url 'second_brain:home' %}" style="font-family: 'Josefin Sans', sans-serif; color: #FFFFFF;">MindMuse</a>
        {% if user.is_authenticated %}
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          
          <ul class="nav nav-pills mx-auto mb-2 mb-lg-0" id="myTab">
            <li class="nav-item">
              <a class="nav-link custom-nav-link d-flex align-items-center {% if url_name == 'second_brain:home' %}active{% endif %}" href="{% url 'second_brain:home' %}">
                <svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                  <path fill="#ffffff" d="M6.13 2.793A3.91 3.91 0 0 1 8.5 2a1.757 1.757 0 0 1 1.5.78A1.757 1.757 0 0 1 11.5 2a3.91 3.91 0 0 1 2.37.793c.525.408.93.973 1.073 1.656c.328.025.628.161.88.366c.382.31.66.775.835 1.267c.274.765.348 1.74.064 2.57c.072.034.143.074.212.12c.275.183.484.445.638.754c.303.605.428 1.449.428 2.474c0 1.141-.435 1.907-.987 2.38a2.68 2.68 0 0 1-1.054.555c-.1.558-.38 1.204-.819 1.752c-.57.715-1.454 1.313-2.64 1.313c-.94 0-1.688-.52-2.174-1.03a4.252 4.252 0 0 1-.326-.385a4.245 4.245 0 0 1-.326.385C9.188 17.48 8.441 18 7.5 18c-1.186 0-2.069-.598-2.64-1.313a4.057 4.057 0 0 1-.819-1.752a2.68 2.68 0 0 1-1.054-.555C2.435 13.907 2 13.14 2 12c0-1.025.126-1.87.428-2.474a1.92 1.92 0 0 1 .638-.755a1.58 1.58 0 0 1 .212-.118c-.284-.832-.21-1.806.064-2.571c.175-.492.453-.957.835-1.267c.252-.205.552-.34.88-.366c.144-.683.549-1.248 1.074-1.656ZM9.5 4.5v-.01l-.002-.05a2.744 2.744 0 0 0-.154-.764a1.222 1.222 0 0 0-.309-.49A.76.76 0 0 0 8.5 3a2.91 2.91 0 0 0-1.756.582C6.28 3.943 6 4.432 6 5a.5.5 0 0 1-.658.474c-.188-.062-.356-.027-.535.117c-.196.16-.387.444-.524.827c-.279.782-.25 1.729.133 2.305A.5.5 0 0 1 4.5 9h.75a2.25 2.25 0 0 1 2.25 2.25v.335a1.5 1.5 0 1 1-1 0v-.335c0-.69-.56-1.25-1.25-1.25H3.5a.499.499 0 0 1-.175-.032l-.003.006C3.124 10.369 3 11.025 3 12c0 .859.315 1.343.638 1.62c.347.298.732.38.862.38a.5.5 0 0 1 .5.5c0 .368.2 1.011.64 1.563c.429.535 1.046.937 1.86.937c.56 0 1.062-.313 1.45-.72c.191-.2.34-.407.437-.577a1.573 1.573 0 0 0 .113-.236V7.5H8.415a1.5 1.5 0 1 1 0-1H9.5v-2Zm1 9.999v.967a1.575 1.575 0 0 0 .113.236c.098.17.246.377.436.577c.389.407.892.72 1.451.72c.814 0 1.431-.402 1.86-.937c.44-.552.64-1.195.64-1.563a.5.5 0 0 1 .5-.5c.13 0 .515-.082.862-.38c.323-.277.638-.761.638-1.62c0-.975-.125-1.63-.322-2.026a.923.923 0 0 0-.3-.37A.657.657 0 0 0 16 9.5a.5.5 0 0 1-.416-.777c.384-.576.412-1.523.133-2.305c-.137-.383-.328-.668-.524-.827c-.179-.144-.347-.18-.535-.117A.5.5 0 0 1 14 5c0-.568-.28-1.057-.745-1.418A2.91 2.91 0 0 0 11.5 3a.76.76 0 0 0-.535.186a1.22 1.22 0 0 0-.31.49a2.579 2.579 0 0 0-.155.814v9.01h.75c.69 0 1.25-.56 1.25-1.25v-1.835a1.5 1.5 0 1 1 1 0v1.835a2.25 2.25 0 0 1-2.25 2.25h-.75ZM6.5 7a.5.5 0 1 0 1 0a.5.5 0 0 0-1 0ZM13 9.5a.5.5 0 1 0 0-1a.5.5 0 0 0 0 1Zm-6 3a.5.5 0 1 0 0 1a.5.5 0 0 0 0-1Z"/>
                </svg>
                <span class="ms-2">Hub</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link custom-nav-link d-flex align-items-center {% if url_name == 'insights:insights' %}active{% endif %}" href="{% url 'insights:insights' %}">
                <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path fill="#ffffff" d="M21 8c-1.45 0-2.26 1.44-1.93 2.51l-3.55 3.56c-.3-.09-.74-.09-1.04 0l-2.55-2.55C12.27 10.45 11.46 9 10 9c-1.45 0-2.27 1.44-1.93 2.52l-4.56 4.55C2.44 15.74 1 16.55 1 18c0 1.1.9 2 2 2c1.45 0 2.26-1.44 1.93-2.51l4.55-4.56c.3.09.74.09 1.04 0l2.55 2.55C12.73 16.55 13.54 18 15 18c1.45 0 2.27-1.44 1.93-2.52l3.56-3.55c1.07.33 2.51-.48 2.51-1.93c0-1.1-.9-2-2-2z"></path>
                  <path fill="#ffffff" d="m15 9l.94-2.07L18 6l-2.06-.93L15 3l-.92 2.07L12 6l2.08.93zM3.5 11L4 9l2-.5L4 8l-.5-2L3 8l-2 .5L3 9z"></path>
                </svg>
                <span class="ms-2">Insights</span>
              </a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link custom-nav-link dropdown-toggle d-flex align-items-center {% if url_name == 'second_brain:profile' %}active{% endif %}" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <g fill="none" fill-rule="evenodd">
                    <path d="M24 0v24H0V0h24ZM12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036c-.01-.003-.019 0-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.016-.018Zm.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01l-.184-.092Z"></path>
                    <path fill="#ffffff" d="M16 15c1.306 0 2.418.835 2.83 2H20a1 1 0 1 1 0 2h-1.17a3.001 3.001 0 0 1-5.66 0H4a1 1 0 1 1 0-2h9.17A3.001 3.001 0 0 1 16 15Zm0 2a1 1 0 1 0 0 2a1 1 0 0 0 0-2ZM8 9a3 3 0 0 1 2.762 1.828l.067.172H20a1 1 0 0 1 .117 1.993L20 13h-9.17a3.001 3.001 0 0 1-5.592.172L5.17 13H4a1 1 0 0 1-.117-1.993L4 11h1.17A3.001 3.001 0 0 1 8 9Zm0 2a1 1 0 1 0 0 2a1 1 0 0 0 0-2Zm8-8c1.306 0 2.418.835 2.83 2H20a1 1 0 1 1 0 2h-1.17a3.001 3.001 0 0 1-5.66 0H4a1 1 0 0 1 0-2h9.17A3.001 3.001 0 0 1 16 3Zm0 2a1 1 0 1 0 0 2a1 1 0 0 0 0-2Z"></path>
                  </g>
                </svg>
                <span class="ms-2">Options</span>
              </a>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item d-flex align-items-center" href="javascript:void(0);" onclick="loadProfileModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <g fill="none" stroke="#ffffff" stroke-width="2.5">
                        <path stroke-linejoin="round" d="M4 18a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2Z"></path>
                        <circle cx="12" cy="7" r="3"></circle>
                      </g>
                    </svg>
                    <span class="ms-2">Profile</span>
                  </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item d-flex align-items-center" href="{% url 'users:logout' %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path fill="none" stroke="#ffffff" stroke-width="2" d="M13 9V2H1v20h12v-7m9-3H5m12-5l5 5l-5 5"></path>
                    </svg>
                    <span class="ms-2">Sign Out</span>
                  </a>
                </li>
              </ul>
            </li>
          </ul>
          {% endif %}
        </div>
      </div>
    </nav>

    <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content" id="profileModalContent">
            <!-- content will be loaded by JS -->
        </div>
      </div>
    </div>
    
    <div class="main-content" style="height: 100vh; width: 100%;">
    {% block content %}
    
    {% endblock %}
    </div>

    <!-- jQuery and Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <!-- content for datepicker -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script>
      
      let tabLinks = document.querySelectorAll('.custom-nav-link');

      function removeActiveStatus() {
        tabLinks.forEach(link => link.classList.remove('active'));
      }

      tabLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          removeActiveStatus();
          e.currentTarget.classList.add('active');
        });
      });

      document.addEventListener('click', function(e) {
        let dropdown = document.querySelector('.nav-item.dropdown .nav-link');
        if (!dropdown.contains(e.target)) {
          dropdown.classList.remove('active');
        }
      });

      // Profile modal js
      async function loadProfileModal() {
          let response = await fetch("{% url 'second_brain:profile' %}", {
              headers: {'X-Requested-With': 'XMLHttpRequest'}
          });
          let data = await response.text();
          document.getElementById('profileModalContent').innerHTML = data;

          var myModal = new bootstrap.Modal(document.getElementById('profileModal'));

          document.getElementById('editProfileForm').addEventListener('submit', async function(e) {
              e.preventDefault();

              let formData = new FormData(this);

              let response = await fetch("{% url 'second_brain:profile' %}", {
                  method: 'POST',
                  headers: {'X-Requested-With': 'XMLHttpRequest'},
                  body: formData
              });

              if (response.ok) {
                  let jsonResponse = await response.json();
                  if (jsonResponse.status === 'success') {
                      alert("Profile updated");
                      myModal.hide();
                  }
              } else {
                  alert("An error occurred");
              }
          });

          myModal.show();
      }

    </script>

    <style>
            /* For larger screens */
      @media (min-width: 992px) {
        .navbar {
          height: 75px;
        }
      }

      /* For smaller screens */
      @media (max-width: 991px) {
        .main-content {
          padding-top: 20px; /* Adjust this value if needed */
        }
      }

      .weather-icon {
        width: 70px;
        height: 70px;
      }

      .card-footer {
        background-color: inherit;
        border-top: none;
      }

      /* Override default nav-link color */
      .nav-link {
          color: #d3d3d3 !important; /* Light grey for inactive tabs */
      }

      /* Style for the active tab */
      .nav-link.active {
          color: #FFFFFF !important; /* White text */
          background-color: #A78EEF !important; /* Lighter purple or your choice of color */
      }

      /* Style for the nav-link hover to indicate it's clickable */
      .nav-link:hover {
          color: #FFFFFF !important; /* Change the font color on hover to white */
      }

      /* Dropdown Menu Styling */
      .dropdown-menu {
          background-color: #452475;  /* Same color as the nav background */
      }

      .dropdown-item {
          color: #d3d3d3;  /* Light grey for dropdown items */
      }

      .dropdown-item:hover {
          background-color: #A78EEF;  /* Lighter purple for hover */
          color: #FFFFFF;  /* White text on hover */
      }

    </style>

  </body>
</html>